<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=DejaVu Sans Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="bigdata," />










<meta name="description" content="《Spark in Action》Chapter4   个人总结：   DStream &amp;lt;- a seq of RDDs &amp;lt;- Partitions key-value RDD = pair RDD  manipulated by funtionByKey()">
<meta name="keywords" content="bigdata">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark API in Depth">
<meta property="og:url" content="http://yoursite.com/2018/11/30/bigdata/SparkInDepth/index.html">
<meta property="og:site_name" content="Peng&#39;S">
<meta property="og:description" content="《Spark in Action》Chapter4   个人总结：   DStream &amp;lt;- a seq of RDDs &amp;lt;- Partitions key-value RDD = pair RDD  manipulated by funtionByKey()">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/005wR1ytgy1fxpu01vvarj30gk07ydg6.jpg">
<meta property="og:updated_time" content="2018-11-30T06:41:24.188Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spark API in Depth">
<meta name="twitter:description" content="《Spark in Action》Chapter4   个人总结：   DStream &amp;lt;- a seq of RDDs &amp;lt;- Partitions key-value RDD = pair RDD  manipulated by funtionByKey()">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/005wR1ytgy1fxpu01vvarj30gk07ydg6.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/30/bigdata/SparkInDepth/"/>





  <title>Spark API in Depth | Peng'S</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Peng'S</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/30/bigdata/SparkInDepth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng'S">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spark API in Depth</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-30T14:41:43+08:00">
                2018-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>《Spark in Action》Chapter4 </p>
</blockquote>
<p>个人总结： </p>
<ul>
<li>DStream &lt;- a seq of RDDs &lt;- Partitions</li>
<li>key-value RDD = pair RDD  manipulated by <code>funtionByKey()</code></li>
</ul>
<a id="more"></a>
<p><img src="http://ww1.sinaimg.cn/large/005wR1ytgy1fxpu01vvarj30gk07ydg6.jpg" alt=""></p>
<h3 id="pair-RDDs"><a href="#pair-RDDs" class="headerlink" title="pair RDDs"></a>pair RDDs</h3><p>key-value 模型是一种简单、通用的数据模型。</p>
<h4 id="Creating"><a href="#Creating" class="headerlink" title="Creating"></a>Creating</h4><p>利用map将RDD中数据转换成二元组（f(element), element)，即RDD-&gt;pair RDD。</p>
<p>原理：二元组形式的RDD会隐式转换为PairRDDFunctions的实例(Scala语法)。</p>
<h4 id="Basic-pair-RDD-functions"><a href="#Basic-pair-RDD-functions" class="headerlink" title="Basic pair RDD functions"></a>Basic pair RDD functions</h4><h5 id="getting-keys-and-values"><a href="#getting-keys-and-values" class="headerlink" title="getting keys and values"></a>getting keys and values</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pRDD.keys.distinct.count()</span><br></pre></td></tr></table></figure>
<h5 id="counting-values-per-key"><a href="#counting-values-per-key" class="headerlink" title="counting values per key"></a>counting values per key</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pRDD.countByKey()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 求最值</span></span><br><span class="line"><span class="keyword">val</span> (cid, purch) = transByCust.countByKey.toSeq.maxBy(_._2)</span><br></pre></td></tr></table></figure>
<h5 id="looking-up-values-for-a-single-key"><a href="#looking-up-values-for-a-single-key" class="headerlink" title="looking up values for a single key"></a>looking up values for a single key</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">transByCust.lookup(<span class="number">53</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印结果</span></span><br><span class="line">transByCust.lookup(<span class="number">53</span>).foreach(tran =&gt; println(tran.mkString(<span class="string">", "</span>)))</span><br></pre></td></tr></table></figure>
<h5 id="using-the-mapValues-transformation-to-change-values-in-a-pair-RDD"><a href="#using-the-mapValues-transformation-to-change-values-in-a-pair-RDD" class="headerlink" title="using the mapValues transformation to change values in  a pair RDD"></a>using the mapValues transformation to change values in  a pair RDD</h5><p>只改变值</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">transByCust = transByCust.mapValues(tran =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (tran(<span class="number">3</span>).toInt == <span class="number">25</span> &amp;&amp; tran(<span class="number">4</span>).toDouble &gt; <span class="number">1</span>)</span><br><span class="line">        tran(<span class="number">5</span>) = (tran(<span class="number">5</span>).toDouble * <span class="number">0.95</span>).toString</span><br><span class="line"></span><br><span class="line">      tran</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="using-the-flatMapValues-transformation-to-add-values-to-keys"><a href="#using-the-flatMapValues-transformation-to-add-values-to-keys" class="headerlink" title="using the flatMapValues transformation to add values to keys"></a>using the flatMapValues transformation to add values to keys</h5><p>此函数可以给一个键添加多个值或一起移除某个键（键的数量会增减）。</p>
<blockquote>
<p>From each of the values in the return collection, a new key-value pair is created for the corresponding key.</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">transByCust = transByCust.flatMapValues(tran =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (tran(<span class="number">3</span>).toInt == <span class="number">81</span> &amp;&amp; tran(<span class="number">4</span>).toDouble &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> cloned = tran.clone()</span><br><span class="line">        cloned(<span class="number">5</span>) = <span class="string">"0.00"</span></span><br><span class="line">        cloned(<span class="number">3</span>) = <span class="string">"70"</span></span><br><span class="line">        cloned(<span class="number">4</span>) = <span class="string">"1"</span></span><br><span class="line">        <span class="type">List</span>(tran, cloned)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">List</span>(tran)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)s</span><br></pre></td></tr></table></figure>
<h5 id="using-reduceByKey-transformation-to-merge-all-values-of-a-key"><a href="#using-reduceByKey-transformation-to-merge-all-values-of-a-key" class="headerlink" title="using reduceByKey transformation to merge all values of a key"></a>using reduceByKey transformation to merge all values of a key</h5><p>foldByKey 与 reduceByKey 类似，区别在于需要一个额外的 zeroValue 参数。</p>
<p><code>foldByKey(zeroValue: V)(func: (V, V) =&gt; V): RDD[(K, V)]</code></p>
<p> 由于RDD的并行特性，zeroValues可能被多次使用。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> amounts = transByCust.mapValues(t =&gt; t(<span class="number">5</span>).toDouble)</span><br><span class="line"><span class="keyword">val</span> totals = amounts.foldByKey(<span class="number">0</span>)(_ + _).collect()</span><br></pre></td></tr></table></figure>
<h5 id="using-aggregateByKey-to-group-all-values-of-a-key"><a href="#using-aggregateByKey-to-group-all-values-of-a-key" class="headerlink" title="using aggregateByKey to group all values of a key"></a>using aggregateByKey to group all values of a key</h5><h4 id="data-partition-and-reducing-data-shuffling"><a href="#data-partition-and-reducing-data-shuffling" class="headerlink" title="data partition and reducing data shuffling"></a>data partition and reducing data shuffling</h4><p>例如，当从本地文件系统加载文件到Spark时，文件内容被分割成分片，最终被分配到集群的结点上。这些分片形成了RDD，同一结点上可能不止一个分片。每个RDD维护一个分片列表。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(transByProd.partitions.length)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The number of RDD partitions is important because, in addition to influencing data distribution throughout the cluster, it also directly determines the number of tasks that will be running RDD transformations. If this number is too small, the cluster will be underutilized. Furthermore, memory problems could result, because working sets might get too big to fit into the memory of executors. We recommend using three to four times more partitions than there are cores in your cluster. Moderately larger values shouldn’t pose a problem, so feel free to experiment. But don’t get too crazy,because management of a large number of tasks could create a bottleneck.</p>
</blockquote>
<h5 id="using-Spark’s-data-partitioners"><a href="#using-Spark’s-data-partitioners" class="headerlink" title="using Spark’s data partitioners"></a>using Spark’s data partitioners</h5><p>两种：HashPartitioner、RangePartitioner。也可定制。</p>
<p>默认是HashPartitioner。</p>
<p>partitionIndex = hashCode % numberOfPartitions</p>
<h5 id="Understanding-and-avoiding-unnecessary-shuffling"><a href="#Understanding-and-avoiding-unnecessary-shuffling" class="headerlink" title="Understanding and avoiding unnecessary shuffling"></a>Understanding and avoiding unnecessary shuffling</h5><blockquote>
<p>Physical movement of data between partitions is called shuffling. </p>
<p>It occurs when data from multiple partitions needs to be combined in order to build partitions <strong>for a new RDD</strong> .When grouping elements by key，shuffling occurs.</p>
</blockquote>
<p>When grouping elements by key，shuffling occurs.</p>
<h5 id="Shuffling-when-explicitly-显式-changing-partitioners"><a href="#Shuffling-when-explicitly-显式-changing-partitioners" class="headerlink" title="Shuffling when explicitly(显式) changing partitioners"></a>Shuffling when explicitly(显式) changing partitioners</h5><blockquote>
<p>Because changing the partitioner provokes shuffles, the safest approach,performance-wise(性能优先), is to use a default partitioner as much as possible and avoidinadvertently causing a shuffle.</p>
</blockquote>
<h5 id="shuffing-caused-by-partitions-removal"><a href="#shuffing-caused-by-partitions-removal" class="headerlink" title="shuffing caused by partitions removal"></a>shuffing caused by partitions removal</h5><p>详细等学Spark优化再看。</p>
<h4 id="Repartitioning-RDDs"><a href="#Repartitioning-RDDs" class="headerlink" title="Repartitioning RDDs"></a>Repartitioning RDDs</h4><h5 id="partitionBy"><a href="#partitionBy" class="headerlink" title="partitionBy"></a>partitionBy</h5><p>只有pair RDD可用，接受一个Partitioner作为参数；当此Partition与原先的不一样时，shuffle发生，重新分片。</p>
<h5 id="collecting-partition-data-with-a-glom-transfotamtion"><a href="#collecting-partition-data-with-a-glom-transfotamtion" class="headerlink" title="collecting partition data with a glom transfotamtion"></a>collecting partition data with a glom transfotamtion</h5><p>glom(意思同 grab)，即将每个分片合成一个数组，用返回的RDD将这些数组作为元素。新RDD的数组数量等于之前的分片数量。这个过程中，partitioner被移除。</p>
<h4 id="Joining-sorting-and-grouping-data"><a href="#Joining-sorting-and-grouping-data" class="headerlink" title="Joining, sorting, and grouping data"></a>Joining, sorting, and grouping data</h4><p>join((K, (V, W))) 非空</p>
<p>leftOuterJoin  (K, (V, Option(W)))</p>
<p>rightOuterJoin (K, (Option(V), W))</p>
<p>fullOuterJoin (K, (Option(V), Option(W))</p>
<h5 id="using-subtract-差集"><a href="#using-subtract-差集" class="headerlink" title="using subtract(差集)"></a>using subtract(差集)</h5><p>…</p>
<h4 id="Using-accumulators-and-broadcast-variables-to-communicate-with-Spark-executors"><a href="#Using-accumulators-and-broadcast-variables-to-communicate-with-Spark-executors" class="headerlink" title="Using accumulators and broadcast variables to communicate with Spark executors"></a>Using accumulators and broadcast variables to communicate with Spark executors</h4><p>作用：维护全局状态或在任务和分片之间共享数据。</p>
<h5 id="sending-data-to-executors-using-broadcast-variables-bv"><a href="#sending-data-to-executors-using-broadcast-variables-bv" class="headerlink" title="sending data to executors using broadcast variables(bv)"></a>sending data to executors using broadcast variables(bv)</h5><p>能在集群间共享，与accumulators不同的是，其不能被执行器修改。驱动创造bv，然后执行器读取它。</p>
<p>当有一个大集合数据需要被绝大多数执行器使用时，应使用bv。</p>
<p>创建：<code>SparkContext.broadcast(value)</code>，读<code>Broadcast.value</code>。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>pair RDD含二元组：keys 和 values。</p>
</li>
<li><p>scala中pair RDD隐式转换为pairRDDFuctions的实例，它有专有的pair RDD操作。</p>
</li>
<li><p>countByKey返回map，含每个键出现的次数。</p>
</li>
<li><p>mapValues，只改变pair RDD的值。</p>
</li>
<li><p>flatMapValues，一个键能对应零个或多个值（键的总数增加）。</p>
</li>
<li><p>reduceByKey和foldByKey，归约同一个键的所有值到一个值，值类型不变。</p>
</li>
<li><p>aggregateByKey，聚合值，但转换值到其它类型。</p>
</li>
<li><p>Data Partition，是Spark的一种在一个集群的多个结点间分数据的机制。</p>
</li>
<li><blockquote>
<p>The number of RDD partitions is important because, in addition to influencing<br>data distribution throughout the cluster, it also directly determines the number<br>of tasks that will be running RDD transformations.</p>
</blockquote>
</li>
<li><p>shffuling时，数据不仅被写到硬盘，而且在网络之间传输。因此，使Spark作业中的shuffle数最小化是重要的。</p>
</li>
<li><blockquote>
<p>Every Spark job is divided into stages based on the points where shuffles occur.</p>
</blockquote>
</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/bigdata/" rel="tag"># bigdata</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/20/python/problem/" rel="next" title="Python编程中邂逅的问题">
                <i class="fa fa-chevron-left"></i> Python编程中邂逅的问题
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/17/bigdata/SparkStreaming/" rel="prev" title="Spark Streaming base on Kafka">
                Spark Streaming base on Kafka <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
   <div id="gitalk-container"></div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Peng</p>
              <p class="site-description motion-element" itemprop="description">Github Personal Website</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#pair-RDDs"><span class="nav-number">1.</span> <span class="nav-text">pair RDDs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating"><span class="nav-number">1.1.</span> <span class="nav-text">Creating</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Basic-pair-RDD-functions"><span class="nav-number">1.2.</span> <span class="nav-text">Basic pair RDD functions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#getting-keys-and-values"><span class="nav-number">1.2.1.</span> <span class="nav-text">getting keys and values</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#counting-values-per-key"><span class="nav-number">1.2.2.</span> <span class="nav-text">counting values per key</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#looking-up-values-for-a-single-key"><span class="nav-number">1.2.3.</span> <span class="nav-text">looking up values for a single key</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#using-the-mapValues-transformation-to-change-values-in-a-pair-RDD"><span class="nav-number">1.2.4.</span> <span class="nav-text">using the mapValues transformation to change values in  a pair RDD</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#using-the-flatMapValues-transformation-to-add-values-to-keys"><span class="nav-number">1.2.5.</span> <span class="nav-text">using the flatMapValues transformation to add values to keys</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#using-reduceByKey-transformation-to-merge-all-values-of-a-key"><span class="nav-number">1.2.6.</span> <span class="nav-text">using reduceByKey transformation to merge all values of a key</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#using-aggregateByKey-to-group-all-values-of-a-key"><span class="nav-number">1.2.7.</span> <span class="nav-text">using aggregateByKey to group all values of a key</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#data-partition-and-reducing-data-shuffling"><span class="nav-number">1.3.</span> <span class="nav-text">data partition and reducing data shuffling</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#using-Spark’s-data-partitioners"><span class="nav-number">1.3.1.</span> <span class="nav-text">using Spark’s data partitioners</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Understanding-and-avoiding-unnecessary-shuffling"><span class="nav-number">1.3.2.</span> <span class="nav-text">Understanding and avoiding unnecessary shuffling</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Shuffling-when-explicitly-显式-changing-partitioners"><span class="nav-number">1.3.3.</span> <span class="nav-text">Shuffling when explicitly(显式) changing partitioners</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#shuffing-caused-by-partitions-removal"><span class="nav-number">1.3.4.</span> <span class="nav-text">shuffing caused by partitions removal</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Repartitioning-RDDs"><span class="nav-number">1.4.</span> <span class="nav-text">Repartitioning RDDs</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#partitionBy"><span class="nav-number">1.4.1.</span> <span class="nav-text">partitionBy</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#collecting-partition-data-with-a-glom-transfotamtion"><span class="nav-number">1.4.2.</span> <span class="nav-text">collecting partition data with a glom transfotamtion</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Joining-sorting-and-grouping-data"><span class="nav-number">1.5.</span> <span class="nav-text">Joining, sorting, and grouping data</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#using-subtract-差集"><span class="nav-number">1.5.1.</span> <span class="nav-text">using subtract(差集)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-accumulators-and-broadcast-variables-to-communicate-with-Spark-executors"><span class="nav-number">1.6.</span> <span class="nav-text">Using accumulators and broadcast variables to communicate with Spark executors</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#sending-data-to-executors-using-broadcast-variables-bv"><span class="nav-number">1.6.1.</span> <span class="nav-text">sending data to executors using broadcast variables(bv)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">1.7.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Peng</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: 'f65636121bc2964d8103',
          clientSecret: 'a11700e292b326c942651a636f32c28e525f2829',
          repo: 'langzi418.github.io',
          owner: 'Langzi418',
          admin: ['Langzi418'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')
       </script>




  





  

  

  

  
  

  

  

  

</body>
</html>
