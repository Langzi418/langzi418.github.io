<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>IO模型 - Blog</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:400,700|Noto+Serif:400,400i&display=swap"
        rel="stylesheet">
    
    <link rel="stylesheet"
        href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/arduino-light.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Blog</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
      
      
      <li class="menu-item">
        
        <a href="/" class="menu-item-link">主页</a>
        
      </li>
      
      
      
      <li class="menu-item">
        
        <a href="/archives" class="menu-item-link">归档</a>
        
      </li>
      
      
      
      <li class="menu-item">
        
        <a href="/me" class="menu-item-link">我</a>
        
      </li>
      
      
      
      <li class="menu-item">
        
        <a href="/atom.xml" class="menu-item-link">订阅</a>
        
      </li>
      
    </ul>
  </nav>
</header>
  <main class="main">
    <article class="post">
    <div class="post-title">
        <h1 class="title">IO模型</h2>
    </div>
    <div class="post-content">
        <h2 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h2><p><a href="https://juejin.im/post/5b94e93b5188255c672e901e" target="_blank" rel="noopener">漫话：如何给女朋友解释什么是Linux的五种IO模型？</a></p>
<h2 id="基于IO多路复用的并发编程"><a href="#基于IO多路复用的并发编程" class="headerlink" title="基于IO多路复用的并发编程"></a>基于IO多路复用的并发编程</h2><p>基于思想是使用select函数，要求内核挂起进程，只有一个或多个I/O事件发生后，才将控制返回给应用程序。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪码</span></span><br><span class="line">listenfd = Open_listenfd(); <span class="comment">//打开一个监听描述符，监听客户端IO事件</span></span><br><span class="line">FD_ZREO(&amp;read_set);  <span class="comment">//创建一个空的读集合</span></span><br><span class="line">FD_SET(STDIN, listenfd, &amp;read_set); <span class="comment">//添加描述符到读集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 典型服务器循环</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123; </span><br><span class="line">	ready_set = read_set;</span><br><span class="line">	select(listenfd+<span class="number">1</span> , &amp;ready_set, ...); <span class="comment">//阻塞直到有描述符可读</span></span><br><span class="line">	<span class="keyword">if</span>(FD_ISSET(STDIN, &amp;ready_set))&#123;</span><br><span class="line">		<span class="comment">// 处理描述符1</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(FD_ISSET(listenfd, &amp;ready_set))&#123;</span><br><span class="line">		<span class="comment">// 处理描述符2</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="基于IO多路复用的并发事件驱动服务器"><a href="#基于IO多路复用的并发事件驱动服务器" class="headerlink" title="基于IO多路复用的并发事件驱动服务器"></a>基于IO多路复用的并发事件驱动服务器</h3><p>事件驱动模型基本逻辑图</p>
<p><img src="https://i.loli.net/2019/07/24/5d37cafb798a377131.jpg" alt=""></p>
<p>参考：</p>
<p><a href="https://kab13098832.weebly.com/event-loops.html" target="_blank" rel="noopener">key features of event driven programs</a></p>
<p>一个例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">listenfd = Open_listenfd();</span><br><span class="line">init_pool(listenfd, &amp;pool); <span class="comment">// 初始化客户端连接池，设置读集合</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">	pool.ready_set = pool.read_set;</span><br><span class="line">	pool.nready = Select(.., &amp;pool.ready_set, ...);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(FD_ISSET(listenfd, &amp;pool.ready_set))&#123; <span class="comment">//如果监听描述符准备好，添加到连接池</span></span><br><span class="line">		add_client();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 处理事件</span></span><br><span class="line">	check_clients(&amp;pool);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>硬编码事件驱动是难以维护的。</p>
<p>参考《深入理解计算机系统（第三版）》12.2</p>
<h2 id="线程模型"><a href="#线程模型" class="headerlink" title="线程模型"></a>线程模型</h2><h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><p>。。。</p>
<h3 id="Reactor模型"><a href="#Reactor模型" class="headerlink" title="Reactor模型"></a>Reactor模型</h3><p>基于事件驱动IO模型</p>
<p><img src="https://i.loli.net/2019/07/24/5d38121e026a580893.jpg" alt=""></p>
<h4 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h4><p><img src="https://i.loli.net/2019/07/24/5d380991489cc11685.jpg" alt=""></p>
<p>个人理解相应代码的逻辑如下图所示。</p>
<p><img src="https://i.loli.net/2019/07/24/5d381e749edb069803.png" alt=""></p>
<h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><p><img src="https://i.loli.net/2019/07/24/5d381eecc15c669653.jpg" alt=""></p>
<h4 id="主从模式"><a href="#主从模式" class="headerlink" title="主从模式"></a>主从模式</h4><p><img src="https://i.loli.net/2019/07/24/5d381f2b41d2570261.jpg" alt=""></p>
<p>与Netty线程模型类似。</p>
<p>参考：</p>
<p><a href="http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf" target="_blank" rel="noopener">DL’s NIO</a></p>

    </div>
    <div class="post-meta">
        <span class="post-time">2019-07-23</span>
    </div>
</article>

<div class="prev_next">
    
<div class="prev">
    
    <a href="/2019/08/02/java/netty1/" class="alignleft prev"
        title="Netty新连接接入过程">&lt;= Netty新连接接入过程</a>
    
</div>
<div class="next">
    
    <a href="/2019/04/22/java/spring/" class="alignright next"
        title="Spring框架的一些理解">Spring框架的一些理解 =&gt;</a>
    
</div>

</div>

<div class="post-comment">
    


</div>
  </main>
</body>

</html>